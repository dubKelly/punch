#!/usr/bin/env python3

import json
import os.path
import sys
import getpass
import datetime

# for arg in sys.argv:
#   if arg == 'in':
#     # open('punch_card.json', 'w')
#     date = datetime.datetime.now().date()
#     time = str(datetime.datetime.now().time())[:8]
def parse_args():
  for arg in sys.argv[1:]:
    if arg == 'in':
      punch_in()

def punch_in():
  user = getpass.getuser()
  date = str(datetime.datetime.now().date())
  time = str(datetime.datetime.now().time())[:8]

  clock_in = {
    user: {
      date: {
        time: 'in'
      }
    }
  }

  if not os.path.exists('./punchcard.json'):
    with open('punchcard.json', 'w+') as punchcard:
      json.dump(clock_in, punchcard)
  else:
    with open('punchcard.json', 'r+') as punchcard:
      _file = json.load(punchcard)
      if _file[user]:
        if _file[user][date]:
          punch_card = {**_file[user][date], **clock_in[user][date]}

      json.dump(punch_card, punchcard)

def main():
  parse_args()

main()
